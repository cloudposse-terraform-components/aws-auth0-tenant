name: "aws-auth0-tenant"
# Canonical GitHub repo
github_repo: "cloudposse-terraform-components/aws-auth0-tenant"
# Short description of this project
description: |-
  This component configures an [Auth0](https://auth0.com/docs/) tenant. This component is used to configure authentication
  for the Terraform provider for Auth0 and to configure the Auth0 tenant itself.
usage: |-
  **Stack Level**: Global

  Here's an example snippet for how to use this component.

  ```yaml
  # catalog/auth0/tenant.yaml
  components:
    terraform:
      auth0/tenant:
        vars:
          enabled: true
          # Make sure this name does not conflict with other Auth0 components, such as `auth0/app`
          name: auth0
          support_email: "tech@acme.com"
          support_url: "https://acme.com"
  ```

  ### Auth0 Tenant Creation

  Chicken before the egg...

  The Auth0 tenant must exist before we can manage it with Terraform. In order to create the Auth0 application used by the
  [Auth0 Terraform provider](https://registry.terraform.io/providers/auth0/auth0/latest/), we must first create the Auth0
  tenant. Then once we have the Auth0 provider configured, we can import the tenant into Terraform. However, the tenant is
  not a resource identifiable by an ID within the Auth0 Management API! We can nevertheless import it using a random
  string. On first run, we import the existing tenant using a random string. It does not matter what this value is.
  Terraform will use the same tenant as the Auth0 application for the Terraform Auth0 Provider.

  Create the Auth0 tenant now using the Auth0 Management API or the Auth0 Dashboard following
  [the Auth0 create tenants documentation](https://auth0.com/docs/get-started/auth0-overview/create-tenants).

  ### Provider Pre-requisites

  Once the Auth0 tenant is created or you've been given access to an existing tenant, you can configure the Auth0 provider
  in Terraform. Follow the
  [Auth0 provider documentation](https://registry.terraform.io/providers/auth0/auth0/latest/docs/guides/quickstart) to
  create a Machine to Machine application.

  > [!TIP]
  >
  > #### Machine to Machine App Name
  >
  > Use the Context Label format for the machine name for consistency. For example, `acme-plat-gbl-prod-auth0-provider`.

  After creating the Machine to Machine application, add the app's domain, client ID, and client secret to AWS Systems
  Manager Parameter Store in the same account and region as this component deployment. The path for the parameters are
  defined by the component deployment's Null Label context ID as follows:

  ```hcl
  auth0_domain_ssm_path        = "/${module.this.id}/domain"
  auth0_client_id_ssm_path     = "/${module.this.id}/client_id"
  auth0_client_secret_ssm_path = "/${module.this.id}/client_secret"
  ```

  For example, if we're deploying `auth0/tenant` into `plat-gbl-prod` and my default region is `us-west-2`, then I would
  add the following parameters to the `plat-prod` account in `us-west-2`:

  > [!IMPORTANT]
  >
  > Be sure that this AWS SSM parameter path does not conflict with SSM parameters used by other Auth0 components, such as
  > `auth0/app`. In both components, the SSM parameter paths are defined by the component deployment's context ID.

  ```
  /acme-plat-gbl-prod-auth0/domain
  /acme-plat-gbl-prod-auth0/client_id
  /acme-plat-gbl-prod-auth0/client_secret
  ```

  <!-- prettier-ignore-start -->
  <!-- prettier-ignore-end -->
references:
  - name: cloudposse-terraform-components
    description: Cloud Posse's upstream component
    url: https://github.com/orgs/cloudposse-terraform-components/repositories
  - name: Auth0 Terraform Provider
    description: ""
    url: https://registry.terraform.io/providers/auth0/auth0/latest/
  - name: Auth0 Documentation
    description: ""
    url: https://auth0.com/docs/
tags: []
# Categories of this project
categories: []
# License of this project
license: "APACHE2"
# Badges to display
badges:
  - name: Latest Release
    image: https://img.shields.io/github/release/cloudposse-terraform-components/aws-auth0-tenant.svg?style=for-the-badge
    url: https://github.com/cloudposse-terraform-components/aws-auth0-tenant/releases/latest
  - name: Slack Community
    image: https://slack.cloudposse.com/for-the-badge.svg
    url: https://slack.cloudposse.com
related:
  - name: "Cloud Posse Terraform Modules"
    description: Our collection of reusable Terraform modules used by our reference architectures.
    url: "https://docs.cloudposse.com/modules/"
  - name: "Atmos"
    description: "Atmos is like docker-compose but for your infrastructure"
    url: "https://atmos.tools"
contributors: [] # If included generates contribs
